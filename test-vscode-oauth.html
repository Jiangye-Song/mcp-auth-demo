<!DOCTYPE html>
<html>

<head>
    <title>OAuth 2.1 Compliant VS Code Test</title>
</head>

<body>
    <h1>OAuth 2.1 Compliant VS Code Authentication Test</h1>

    <div style="background-color: #e8f4fd; padding: 15px; margin: 10px 0; border-radius: 5px;">
        <h3>üîí OAuth 2.1 Compliance Notice</h3>
        <p>This server only supports OAuth 2.1 authorization code flow with query parameters. Hash fragment patterns
            have been removed for security and compliance.</p>
    </div>

    <h2>Current URL:</h2>
    <p id="currentUrl"></p>

    <h2>URL Parameters (Query) - OAuth 2.1 Compliant:</h2>
    <div id="queryParams"></div>

    <h2>Actions:</h2>
    <button onclick="testAuthCodeFlow()"
        style="background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px;">
        Test OAuth 2.1 Authorization Code Flow
    </button>

    <div style="background-color: #fff3cd; padding: 10px; margin: 10px 0; border-radius: 5px;">
        <strong>Note:</strong> Hash fragment authentication has been removed for OAuth 2.1 compliance.
    </div>

    <script>
        // Display current URL
        document.getElementById('currentUrl').textContent = window.location.href;

        // Parse and display query parameters (OAuth 2.1 compliant)
        const urlParams = new URLSearchParams(window.location.search);
        const queryDiv = document.getElementById('queryParams');
        if (urlParams.toString()) {
            const params = Array.from(urlParams.entries()).map(([k, v]) => {
                // Mask sensitive values for security
                if (k === 'code' || k === 'access_token') {
                    return `${k}: ${v.substring(0, 10)}... [MASKED]`;
                }
                return `${k}: ${v}`;
            });
            queryDiv.innerHTML = '<pre style="background-color: #f8f9fa; padding: 10px; border-radius: 3px;">' + params.join('\n') + '</pre>';

            // Check for OAuth 2.1 compliance
            if (urlParams.has('code')) {
                queryDiv.innerHTML += '<p style="color: #28a745; font-weight: bold;">‚úÖ OAuth 2.1 Compliant: Authorization code flow detected</p>';
            }
        } else {
            queryDiv.innerHTML = '<p style="color: #6c757d;">No query parameters (waiting for OAuth callback)</p>';
        }

        // OAuth 2.1 compliant authorization code flow test
        function testAuthCodeFlow() {
            // Test with authorization code (OAuth 2.1 compliant)
            const testUrl = 'http://127.0.0.1:33418/?code=test_auth_code_oauth21&state=test_state&session_state=session123';
            console.log('Testing OAuth 2.1 Authorization Code Flow:', testUrl);
            window.location.href = testUrl;
        }

        // Check if current URL contains hash fragments (non-compliant)
        if (window.location.hash) {
            const warningDiv = document.createElement('div');
            warningDiv.style.cssText = 'background-color: #f8d7da; color: #721c24; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #f5c6cb;';
            warningDiv.innerHTML = '<strong>‚ö†Ô∏è OAuth 2.1 Compliance Warning:</strong> Hash fragments detected in URL. This server no longer supports hash fragment authentication for OAuth 2.1 compliance.';
            document.body.insertBefore(warningDiv, document.body.firstChild);
        }
    </script>
</body>

</html>